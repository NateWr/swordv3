(function(e){"use strict";const Q=(r,V)=>{const k=r.__vccOpts||r;for(const[b,B]of V)k[b]=B;return k},z={class:"swordv3-modal-root fixed inset-0 overflow-scroll flex justify-center items-center"},I={class:"swordv3-modal-content bg-secondary"},O={class:"swordv3-modal-close"},W={class:"sr-only"},G={class:"flex items-center gap-x-2"},J={key:0,class:"flex items-center gap-2"},K={class:"flex items-center gap-2"},L=Q({__name:"SwordDepositsListModal",props:{status:{type:String,required:!0},title:{type:String,required:!0},description:{type:String,required:!0},depositAction:{type:Function,required:!0},redeposit:{type:String,required:!0},redepositAction:{type:Function,default:null},close:{type:Function,required:!0},itemsPerPage:{type:Number,required:!0}},setup(r){const{useDate:V}=pkp.modules.useDate,{useLocalize:k}=pkp.modules.useLocalize,{useUrl:b}=pkp.modules.useUrl,{useFetch:B}=pkp.modules.useFetch,{t:i}=k(),{formatShortDate:t}=V(),N=r,u=e.ref(!0),E=e.ref([]),$=e.ref(1),y=e.ref(0),_=async()=>{u.value=!0;const{pageUrl:p}=b(`swordv3/getPublications/${N.status}/${$.value}`),{data:g,isSuccess:f,fetch:h}=B(p);await h(),f.value&&(E.value=g.value.publications,y.value=g.value.total),u.value=!1},S=async p=>{await N.depositAction(p),N.close()},x=async()=>{await N.redepositAction(),N.close()},m=e.computed(()=>Math.ceil(y.value/N.itemsPerPage)),D=p=>{$.value=p,_()};return e.onMounted(()=>{_()}),(p,g)=>{const f=e.resolveComponent("PkpIcon"),h=e.resolveComponent("PkpButton"),w=e.resolveComponent("PkpTableColumn"),T=e.resolveComponent("PkpTableHeader"),j=e.resolveComponent("PkpSpinner"),C=e.resolveComponent("PkpTableCell"),U=e.resolveComponent("PkpTableRow"),A=e.resolveComponent("PkpTableBody"),F=e.resolveComponent("PkpTable"),q=e.resolveComponent("PkpPagination");return e.openBlock(),e.createElementBlock("div",z,[e.createElementVNode("div",I,[e.createElementVNode("div",O,[e.createElementVNode("button",{onClick:g[0]||(g[0]=(...c)=>r.close&&r.close(...c))},[e.createVNode(f,{icon:"Cancel",class:"h-5 w-5"}),e.createElementVNode("span",W,e.toDisplayString(e.unref(i)("common.close")),1)])]),e.createVNode(F,null,{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(r.title),1)]),description:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(r.description),1)]),"top-controls":e.withCtx(()=>[e.createElementVNode("div",G,[r.redeposit&&r.redepositAction?(e.openBlock(),e.createBlock(h,{key:0,isDisabled:E.value.length<=0,onClick:x},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(r.redeposit),1)]),_:1},8,["isDisabled"])):e.createCommentVNode("",!0)])]),default:e.withCtx(()=>[e.createVNode(T,null,{default:e.withCtx(()=>[e.createVNode(w,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(i)("common.id")),1)]),_:1}),e.createVNode(w,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(i)("manager.distribution.publication")),1)]),_:1}),e.createVNode(w,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(i)("common.status")),1)]),_:1}),r.status!=="ready"?(e.openBlock(),e.createBlock(w,{key:0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(i)("plugins.generic.swordv3.dateDeposited")),1)]),_:1})):e.createCommentVNode("",!0),e.createVNode(w,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(i)("common.action")),1)]),_:1})]),_:1}),e.createVNode(A,null,{"no-content":e.withCtx(()=>[u.value?(e.openBlock(),e.createElementBlock("div",J,[e.createVNode(j),e.createElementVNode("span",null,e.toDisplayString(e.unref(i)("common.loading")),1)])):e.createCommentVNode("",!0)]),default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E.value,c=>(e.openBlock(),e.createBlock(U,{key:c.id},{default:e.withCtx(()=>[e.createVNode(C,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(c.id),1)]),_:2},1024),e.createVNode(C,{isRowHeader:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(i)("plugins.generic.swordv3.titleWithVersion",{version:e.unref(i)("publication.version",{version:c.version}),title:c.title})),1)]),_:2},1024),e.createVNode(C,null,{default:e.withCtx(()=>[r.status==="ready"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createTextVNode(e.toDisplayString(e.unref(i)("plugins.generic.swordv3.status.ready")),1)],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createTextVNode(e.toDisplayString(c.swordv3State.replace("http://purl.org/net/sword/3.0/state/","")),1)],64))]),_:2},1024),r.status!=="ready"?(e.openBlock(),e.createBlock(C,{key:0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)(c.swordv3DateDeposited)),1)]),_:2},1024)):e.createCommentVNode("",!0),e.createVNode(C,null,{default:e.withCtx(()=>[e.createElementVNode("div",K,[e.createVNode(h,{class:"swordv3-whitespace-no-wrap",onClick:M=>S(c.id)},{default:e.withCtx(()=>[r.status==="ready"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createTextVNode(e.toDisplayString(e.unref(i)("plugins.generic.swordv3.action.deposit")),1)],64)):r.status==="deposited"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createTextVNode(e.toDisplayString(e.unref(i)("plugins.generic.swordv3.action.redeposit")),1)],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[e.createTextVNode(e.toDisplayString(e.unref(i)("plugins.generic.swordv3.action.tryAgain")),1)],64))]),_:1},8,["onClick"]),r.status!=="ready"?(e.openBlock(),e.createBlock(h,{key:0,class:"swordv3-whitespace-no-wrap",element:"a",href:c.exportStatusDocumentUrl},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(i)("plugins.generic.swordv3.exportStatusDocument")),1)]),_:1},8,["href"])):e.createCommentVNode("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),m.value>1?(e.openBlock(),e.createBlock(q,{key:0,"current-page":$.value,"is-loading":u.value,"last-page":m.value,"show-adjacent-pages":2,onSetPage:D},null,8,["current-page","is-loading","last-page"])):e.createCommentVNode("",!0)])])}}},[["__scopeId","data-v-293bfa5e"]]),X={key:0},Y={key:1,class:"flex flex-col gap-8"},Z={class:"flex items-center gap-x-2"},v={key:1,class:"me-2 text-sm"},ee={class:"flex items-center gap-2"},te={class:"flex items-center gap-2"},oe={id:"swordv3-redeposit-all-desc"},ne={__name:"SwordDepositsOverview",props:{exportCsvUrl:{type:String,required:!0},itemsPerPage:{type:Number,required:!0},serviceName:{type:String,required:!0}},setup(r){const{useUrl:V}=pkp.modules.useUrl,{useFetch:k}=pkp.modules.useFetch,{useLocalize:b}=pkp.modules.useLocalize,{useModal:B}=pkp.modules.useModal,{useNotify:i}=pkp.modules.useNotify,{t}=b(),{openDialog:N,openSideModal:u,closeSideModal:E}=B(),{notify:$}=i(),y=r,_=e.ref(!1),S=e.ref(!1),x=e.ref(0),m=e.ref(0),D=e.ref(0),p=e.ref(0),g=e.ref(0),f=e.ref(0),h=e.computed(()=>x.value+D.value+p.value+g.value+f.value),w=async()=>{const{pageUrl:a}=V("swordv3/overview"),{data:o,isSuccess:l,fetch:n}=k(a);await n(),l.value&&(x.value=o.value.ready,m.value=o.value.queued,D.value=o.value.deposited,p.value=o.value.rejected,g.value=o.value.deleted,f.value=o.value.unknown)},T=async()=>{await w(),m.value&&setTimeout(T,2e3)},j=(a,o)=>{$(t("plugins.generic.swordv3.action.depositsQueued",{count:a,service:o}),"success")},C=async(a=null)=>{S.value=!0;const o=`swordv3/deposit${a?`/${a}`:""}`,{pageUrl:l}=V(o),{data:n,isSuccess:d,fetch:H}=k(l,{method:"PUT"});await H(),d.value&&(await w(),j(n.value.count,y.serviceName),T()),S.value=!1},U=async(a=null)=>{const{pageUrl:o}=V(a?`swordv3/redeposit/${a}`:"swordv3/redeposit"),{data:l,isSuccess:n,fetch:d}=k(o,{method:"PUT"});await d(),n.value&&(await w(),j(l.value.count,y.serviceName),T())},A=async()=>await U("rejected"),F=async()=>await U("deleted"),q=(a=null)=>{let o=t("plugins.generic.swordv3.action.redepositAll"),l=t("plugins.generic.swordv3.action.redepositAll.button"),n=h.value;a==="rejected"?(o=t("plugins.generic.swordv3.action.redepositRejected"),l=t("plugins.generic.swordv3.action.redepositRejected"),n=p.value):a==="deleted"?(o=t("plugins.generic.swordv3.action.redepositDeleted"),l=t("plugins.generic.swordv3.action.redepositDeleted"),n=g.value):a==="unknown"&&(o=t("plugins.generic.swordv3.action.redepositUnknown"),l=t("plugins.generic.swordv3.action.redepositUnknown"),n=f.value),N({title:o,message:t("plugins.generic.swordv3.action.redeposit.confirm",{count:n,service:y.serviceName}),actions:[{label:l,isPrimary:!0,callback:async d=>{await U(a),d()}},{label:t("common.cancel"),isWarnable:!0,callback:d=>{d()}}],modalStyle:"basic"})},c=a=>{let o,l,n="",d=null;switch(a){case"ready":o=t("plugins.generic.swordv3.status.ready"),l=t("plugins.generic.swordv3.status.ready.withCount",{count:x.value});break;case"deposited":o=t("plugins.generic.swordv3.status.deposited"),l=t("plugins.generic.swordv3.status.deposited.withCount",{count:D.value});break;case"rejected":o=t("plugins.generic.swordv3.status.rejected"),l=t("plugins.generic.swordv3.status.rejected.withCount",{count:p.value}),n=t("plugins.generic.swordv3.action.redepositRejected"),d=A;break;case"deleted":o=t("plugins.generic.swordv3.status.deleted"),l=t("plugins.generic.swordv3.status.deleted.withCount",{count:g.value}),n=t("plugins.generic.swordv3.action.redepositDeleted"),d=F;break;case"unknown":o=t("plugins.generic.swordv3.status.unknown"),l=t("plugins.generic.swordv3.status.unknown.withCount",{count:f.value});break}u(L,{status:a,title:o,description:l,depositAction:C,itemsPerPage:y.itemsPerPage,redeposit:n,redepositAction:d,close:M})},M=()=>{E(L)};return e.onMounted(()=>{_.value=!0,w().then(()=>{_.value=!1,m.value&&setTimeout(T,2e3)})}),(a,o)=>{const l=e.resolveComponent("PkpSpinner"),n=e.resolveComponent("PkpButton"),d=e.resolveComponent("PkpTableColumn"),H=e.resolveComponent("PkpTableHeader"),s=e.resolveComponent("PkpTableCell"),R=e.resolveComponent("PkpTableRow"),re=e.resolveComponent("PkpTableBody"),le=e.resolveComponent("pkp-button"),se=e.resolveComponent("PkpTable"),ae=e.resolveComponent("PkpActionPanel");return _.value?(e.openBlock(),e.createElementBlock("div",X,[e.createVNode(l)])):(e.openBlock(),e.createElementBlock("div",Y,[e.createVNode(se,null,{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("plugins.generic.swordv3.name")),1)]),description:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.ready.withCount",{count:x.value})),1)]),"top-controls":e.withCtx(()=>[e.createElementVNode("div",Z,[S.value||m.value?(e.openBlock(),e.createBlock(l,{key:0})):e.createCommentVNode("",!0),m.value?(e.openBlock(),e.createElementBlock("div",v,e.toDisplayString(e.unref(t)("plugins.generic.swordv3.processingQueue",{count:m.value})),1)):e.createCommentVNode("",!0),e.createVNode(n,{"is-primary":!0,"is-disabled":x.value<=0||S.value,onClick:o[0]||(o[0]=P=>C(null))},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("plugins.generic.swordv3.action.deposit")),1)]),_:1},8,["is-disabled"])])]),"bottom-controls":e.withCtx(()=>[e.createElementVNode("div",te,[e.createVNode(le,{element:"a",href:r.exportCsvUrl},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("plugins.generic.swordv3.action.exportToCsv")),1)]),_:1},8,["href"])])]),default:e.withCtx(()=>[e.createVNode(H,null,{default:e.withCtx(()=>[e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("common.status")),1)]),_:1}),e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("common.description")),1)]),_:1}),e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("common.count")),1)]),_:1}),e.createVNode(d,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("common.action")),1)]),_:1})]),_:1}),e.createVNode(re,null,{default:e.withCtx(()=>[e.createVNode(R,null,{default:e.withCtx(()=>[e.createVNode(s,{isRowHeader:!0},{default:e.withCtx(()=>[e.createElementVNode("strong",null,e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.ready")),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.ready.description")),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(x.value),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createVNode(n,{onClick:o[1]||(o[1]=P=>c("ready"))},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("common.view")),1)]),_:1})]),_:1})]),_:1}),e.createVNode(R,null,{default:e.withCtx(()=>[e.createVNode(s,{isRowHeader:!0},{default:e.withCtx(()=>[e.createElementVNode("strong",null,e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.deposited")),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.deposited.description")),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.value),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createVNode(n,{onClick:o[2]||(o[2]=P=>c("deposited"))},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("common.view")),1)]),_:1})]),_:1})]),_:1}),e.createVNode(R,null,{default:e.withCtx(()=>[e.createVNode(s,{isRowHeader:!0},{default:e.withCtx(()=>[e.createElementVNode("strong",null,e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.rejected")),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.rejected.description")),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(p.value),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createVNode(n,{class:"shrink-0",onClick:o[3]||(o[3]=P=>c("rejected"))},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("common.view")),1)]),_:1})]),_:1})]),_:1}),e.createVNode(R,null,{default:e.withCtx(()=>[e.createVNode(s,{isRowHeader:!0},{default:e.withCtx(()=>[e.createElementVNode("strong",null,e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.deleted")),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.deleted.description")),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(g.value),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createVNode(n,{class:"shrink-0",onClick:o[4]||(o[4]=P=>c("deleted"))},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("common.view")),1)]),_:1})]),_:1})]),_:1}),e.createVNode(R,null,{default:e.withCtx(()=>[e.createVNode(s,{isRowHeader:!0},{default:e.withCtx(()=>[e.createElementVNode("strong",null,e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.unknown")),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("plugins.generic.swordv3.status.unknown.description")),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(f.value),1)]),_:1}),e.createVNode(s,null,{default:e.withCtx(()=>[e.createElementVNode("div",ee,[e.createVNode(n,{class:"shrink-0",onClick:o[5]||(o[5]=P=>c("unknown"))},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("common.view")),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e.createVNode(ae,{class:"border border-light p-8"},{actions:e.withCtx(()=>[e.createVNode(n,{"aria-describedby":"swordv3-redeposit-all-desc",onClick:o[6]||(o[6]=P=>q(null))},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(t)("plugins.generic.swordv3.action.redepositAll.button")),1)]),_:1})]),default:e.withCtx(()=>[e.createElementVNode("h2",null,e.toDisplayString(e.unref(t)("plugins.generic.swordv3.action.redepositAll")),1),e.createElementVNode("p",oe,e.toDisplayString(e.unref(t)("plugins.generic.swordv3.action.redepositAll.description")),1)]),_:1})]))}}};pkp.registry.registerComponent("SwordDepositsOverview",ne)})(pkp.modules.vue);
